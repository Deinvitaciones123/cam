<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Invitación</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Hugs+and+Kisses&display=swap');

  body {
    font-family: 'Arial', sans-serif;
    text-align: center;
    margin: 0;
    height: 100vh;
    overflow: hidden;
    /* background: url('https://i0.wp.com/i.pinimg.com/originals/12/d6/8a/12d68aeeabea27504d88c415044248af.gif') no-repeat center center fixed; */
    background-size: cover;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 30px;
    padding: 50px 0;
  }

  h2 {
    font-family: 'Hugs and Kisses', cursive;
    color: #fff;
    font-size: 60px;
    text-shadow: 0 0 5px #ffb3c1, 0 0 10px #ff6ec7, 0 0 20px #ff6ec7;
    z-index: 2;
    position: relative;
  }

  #fotoBtn, #retakeBtn, #uploadBtn {
    background: linear-gradient(45deg, #ff6ec7, #ff8c42, #ff6ec7);
    background-size: 400% 400%;
    border: none;
    color: white;
    padding: 18px 40px;
    font-size: 20px;
    font-weight: bold;
    border-radius: 15px;
    cursor: pointer;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    box-shadow: 0 6px 20px rgba(0,0,0,0.25);
    animation: gradientBG 5s ease infinite;
    z-index: 2;
    position: relative;
    overflow: hidden;
    margin: 5px;
  }

  #fotoBtn:hover, #retakeBtn:hover, #uploadBtn:hover {
    transform: scale(1.1);
    box-shadow: 0 10px 25px rgba(0,0,0,0.35);
  }

  #fotoBtn::after, #retakeBtn::after, #uploadBtn::after {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.5) 10%, transparent 10%);
    background-size: 10% 10%;
    animation: sparkle 1s linear infinite;
    pointer-events: none;
  }

  @keyframes sparkle {
    0% { transform: rotate(0deg) translate(0,0); }
    100% { transform: rotate(360deg) translate(0,0); }
  }

  #video {
    border-radius: 25px;
    border: 5px solid #ff8c42;
    height:80vh;
    max-height: 900px;
    width: 90vw;       /* usar casi todo el ancho de pantalla */
    max-width: 900px;  /* pero no más de 500px en pantallas grandes */
    object-fit: cover;
    z-index: 2;
    position: relative;
    box-shadow: 0 0 20px #ff6ec7, 0 0 40px #ffb3c1, 0 0 60px #ff6ec7;
    animation: glow 2s ease-in-out infinite alternate;
  }

  #preview {
    border-radius: 25px;
    border: 5px solid #ff8c42;
    height:80vh;
    max-height: 900px;
    width: 90vw;       /* usar casi todo el ancho de pantalla */
    max-width: 900px;  /* pero no más de 500px en pantallas grandes */
    object-fit: cover;
    display: none;
    z-index: 2;
    position: relative;
    box-shadow: 0 0 20px #ff6ec7, 0 0 40px #ffb3c1, 0 0 60px #ff6ec7;
  }

  @keyframes glow {
    0% { box-shadow: 0 0 20px #ff6ec7, 0 0 40px #ffb3c1, 0 0 60px #ff6ec7; }
    100% { box-shadow: 0 0 40px #ff6ec7, 0 0 60px #ffb3c1, 0 0 80px #ff6ec7; }
  }

  @keyframes gradientBG {
    0% {background-position: 0% 50%;}
    50% {background-position: 100% 50%;}
    100% {background-position: 0% 50%;}
  }

  .heart, .star {
    position: absolute;
    width: 20px;
    height: 20px;
    animation: floatUp linear infinite;
  }

  .heart {
    background-color: rgba(255,108,199,0.8);
    clip-path: polygon(50% 0%, 61% 12%, 75% 12%, 87% 25%, 87% 38%, 75% 50%, 50% 75%, 25% 50%, 13% 38%, 13% 25%, 25% 12%, 39% 12%);
  }

  .star {
    background-color: rgba(255,255,255,0.7);
    clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
  }

  @keyframes floatUp {
    0% { transform: translateY(100vh) scale(1); opacity: 0; }
    10% { opacity: 1; }
    100% { transform: translateY(-100px) scale(0.5); opacity: 0; }
  }
</style>
</head>
<body>
  <h2>¡Gracias por acompañarnos!</h2>
  <video id="video" autoplay></video>
  <img id="preview" />
  <div id="btnsContainer">
    <button id="fotoBtn">Tomar Foto</button>
  </div>
  <canvas id="canvas" style="display:none;"></canvas>

  <script>
    function createFloating() {
      const isHeart = Math.random() > 0.3;
      const div = document.createElement('div');
      div.className = isHeart ? 'heart' : 'star';
      div.style.left = Math.random() * window.innerWidth + 'px';
      const size = 10 + Math.random() * 25;
      div.style.width = div.style.height = size + 'px';
      div.style.animationDuration = (5 + Math.random() * 5) + 's';
      document.body.appendChild(div);
      setTimeout(() => div.remove(), 10000);
    }
    setInterval(createFloating, 300);

    const btn = document.getElementById("fotoBtn");
    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const context = canvas.getContext("2d");
    const preview = document.getElementById("preview");
    const btnsContainer = document.getElementById("btnsContainer");

    let stream;

    let useFront = true;

    async function startCamera() {
      if (stream) {
        stream.getTracks().forEach(track => track.stop()); // detener la anterior
      }

      stream = await navigator.mediaDevices.getUserMedia({ 
        video: { facingMode: useFront ? "user" : "environment" }
      });

      video.srcObject = stream;
      video.style.display = "block";
      preview.style.display = "none";
      btnsContainer.innerHTML = `
        <button id="fotoBtn">Tomar Foto</button>
        <button id="flipBtn">Voltear Cámara</button>
      `;
      document.getElementById("fotoBtn").onclick = takePhoto;
      document.getElementById("flipBtn").onclick = () => {
        useFront = !useFront;
        startCamera();
      };
    }

    async function takePhoto() {
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      context.drawImage(video, 0, 0);
      const imgData = canvas.toDataURL("image/png");

      // Mostrar previsualización
      preview.src = imgData;
      preview.style.display = "block";
      video.style.display = "none";

      // Mostrar botones Tomar otra y Subir
      btnsContainer.innerHTML = `
        <button id="retakeBtn">Tomar Otra</button>
        <button id="uploadBtn">Subir</button>
      `;

      document.getElementById("retakeBtn").onclick = () => {
        startCamera();
      };

document.getElementById("uploadBtn").onclick = () => {
  fetch("https://script.google.com/macros/s/AKfycbyOstIwlAWD5uIKbJOgHWEJZDXHJ3myZX-9EDlQZZ988lwl1AT_dlKulz8rjLbmxhgHqg/exec", {
    method: "POST",
    body: JSON.stringify({ image: imgData })
  })
  .then(res => res.text())
  .then(msg => {
    alert(msg); // opcional
  })
  .catch(err => alert("Error: " + err))
  .finally(() => {
    // Detener la cámara
    if (stream) {
      stream.getTracks().forEach(track => track.stop());
    }

    // Vaciar todo el body
    document.body.innerHTML = `
      <h1 style="
        font-family: 'Hugs and Kisses', cursive; 
        color: #fff; 
        font-size: 50px; 
        text-align: center; 
        margin-top: 20%;
        text-shadow: 0 0 5px #ffb3c1, 0 0 10px #ff6ec7, 0 0 20px #ff6ec7;
      ">
        Gracias por tu presencia, es muy importante para nosotros en este día tan especial
      </h1>
    `;

    // Mantener el fondo animado original
    // document.body.style.background = "url('https://i0.wp.com/i.pinimg.com/originals/12/d6/8a/12d68aeeabea27504d88c415044248af.gif') no-repeat center center fixed";
    document.body.style.backgroundSize = "cover";
    document.body.style.display = "flex";
    document.body.style.justifyContent = "center";
    document.body.style.alignItems = "center";
    document.body.style.flexDirection = "column";
    document.body.style.height = "100vh";
  });
};


    }
    
    startCamera();

    btn.onclick = takePhoto;
  </script>
</body>
</html>


